<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­·å²åœ°åœ–-æ—¥æœ¬ç¯‡</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; }

        .controls-overlay {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, rgba(255,255,255,0.95) 0%, transparent 100%);
            padding: 20px 40px 40px; z-index: 1000; pointer-events: none;
        }
        .controls-content { pointer-events: auto; max-width: 1200px; margin: 0 auto; }

        .progress-container {
            position: relative; height: 24px; display: flex;
            align-items: center; cursor: pointer; margin-bottom: 20px;
        }
        .progress-bg { height: 10px; width: 100%; background: rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background: #e74c3c; width: 0%; border-radius: 10px; transition: width 0.2s ease-out; }

        .bottom-ui { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        
        .play-btn {
            background: #2c3e50; border: none; color: #fff;
            width: 55px; height: 55px; border-radius: 50%; cursor: pointer;
            font-size: 22px; display: flex; align-items: center; justify-content: center;
            transition: background 0.2s;
        }
        .play-btn:hover { background: #e74c3c; }

        .about-widget {
    position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
    z-index: 1001; display: flex; flex-direction: column; align-items: flex-end;
}

.about-btn {
    width: 50px; height: 50px; background: #2c3e50; color: white;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 24px; font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.about-btn:hover { background: #e74c3c; transform: scale(1.1); }

.about-panel {
    width: 0; height: 0; opacity: 0; overflow: hidden;
    background: rgba(255, 255, 255, 0.95); border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    transition: all 0.4s ease; position: relative;
    backdrop-filter: blur(5px); border: 1px solid #ddd;
}

/* æ“´å±•å¾Œçš„ç‹€æ…‹ */
.about-panel.expanded {
    width: 300px; height: auto; min-height: 400px; opacity: 1; padding: 25px;
    margin-right: 10px;
}

.close-about { position: absolute; top: 15px; right: 15px; cursor: pointer; font-size: 20px; color: #95a5a6; }
.close-about:hover { color: #e74c3c; }

.about-content h2 { margin-top: 0; color: #2c3e50; border-bottom: 2px solid #e74c3c; padding-bottom: 10px; }
.era-badge { background: #e67e22; color: white; padding: 4px 12px; border-radius: 20px; font-weight: bold; display: inline-block; }


        .year-info { display: flex; flex-direction: column; min-width: 220px; }
        .year-label { font-size: 26px; font-weight: 900; color: #2c3e50; line-height: 1; }
        
        .control-group {
            display: flex; align-items: center; gap: 8px;
            background: rgba(255,255,255,0.9); padding: 8px 15px;
            border-radius: 8px; border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .year-input { width: 80px; padding: 6px; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
        
        .speed-ctrl { display: flex; align-items: center; gap: 5px; }
        .speed-display {
            background: #f8f9fa; border: 1px solid #ccc; color: #2c3e50; 
            padding: 6px 0; border-radius: 4px; font-weight: bold; font-size: 14px;
            width: 70px; text-align: center;
        }
        
        .ui-btn {
            background: #34495e; color: white; border: none; 
            padding: 6px 12px; border-radius: 4px; cursor: pointer; 
            font-size: 14px; font-weight: bold; transition: background 0.2s;
        }
        .ui-btn:hover { background: #e74c3c; }

        /* Popup æ¨£å¼å„ªåŒ– */
        .source-list { margin: 8px 0 0 0; padding-left: 18px; font-size: 13px; }
        .source-link { color: #2ecc71; text-decoration: none; font-weight: bold; }
        .source-link:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="about-widget" id="aboutWidget">
    <div class="about-panel" id="aboutPanel">
        <span class="close-about" id="closeAbout">Ã—</span>
        <div class="about-content">
            <h2>é—œæ–¼æœ¬åœ–</h2>
            <p>é€™æ˜¯ä¸€å€‹äº’å‹•å¼æ­·å²åœ°ç†ç³»çµ±ã€‚é€éæ™‚é–“è»¸çš„æ»‘å‹•ï¼Œæ‚¨å¯ä»¥è§€å¯Ÿå„å€‹åœ°å€æ–‡æ˜èˆ‡æ™‚ä»£çš„ç™¼å±•éç¨‹ã€‚ç›®å‰åªè£½ä½œæ—¥æœ¬åœ°å€</p>
            <p><b>æ“ä½œæŒ‡å—ï¼š</b></p>
            <ul style="font-size: 13px; color: #7f8c8d;">
                <li>æ‹–å‹•ä¸‹æ–¹é€²åº¦æ¢åˆ‡æ›å¹´ä»½</li>
                <li>ä½¿ç”¨æ’­æ”¾æŒ‰éˆ•ï¼ˆâ–¶ï¼‰è‡ªå‹•é‹è¡Œ</li>
                <li>èª¿æ•´é€Ÿåº¦ç´šåˆ¥ï¼ˆ1-100å¹´ï¼‰</li>
            </ul>
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
            <p><b>è‹¥æœ‰éŒ¯èª¤æˆ–å»ºè­°è«‹è¯çµ¡æˆ‘ï¼š</b></p>
            <div><a href="mailto:rty89209@gmail.com" class="contact-link">rty89209@gmail.com</a></div>
        </div>
    </div>
    <div class="about-btn" id="aboutBtn">i</div>
</div>

<div class="controls-overlay">
    <div class="controls-content">
        <div class="progress-container" id="progressContainer">
            <div class="progress-bg"><div class="progress-bar" id="progressBar"></div></div>
        </div>

        <div class="bottom-ui">
            <button class="play-btn" id="playBtn">â–¶</button>
            
            <div class="year-info">
                <div class="year-label" id="yearLabel">è¼‰å…¥ä¸­...</div>
                <div style="font-size: 11px; color: #7f8c8d; margin-top: 4px;">æ»¾è¼ªç¸®æ”¾åœ°åœ– / ä½¿ç”¨æŒ‰éˆ•æ§åˆ¶æ™‚é–“</div>
            </div>

            <div class="control-group">
                <span style="font-size: 13px; font-weight: bold; color: #34495e;">è·³è½‰:</span>
                <input type="number" id="manualYearInput" class="year-input" placeholder="å¹´ä»½">
                <button class="ui-btn" id="jumpBtn">åŸ·è¡Œ</button>
            </div>

            <div class="control-group">
                <span style="font-size: 13px; font-weight: bold; color: #34495e;">é‹è¡Œé€Ÿåº¦:</span>
                <div class="speed-ctrl">
                    <button class="ui-btn" onclick="changeSpeed(-1)">ï¼</button>
                    <div class="speed-display" id="speedDisplay">10 å¹´</div>
                    <button class="ui-btn" onclick="changeSpeed(1)">ï¼‹</button>
                </div>
            </div>

            <div style="font-size: 11px; color: #95a5a6; margin-left: auto; text-align: right;">
                é€Ÿåº¦ç´šåˆ¥ï¼š1, 5, 10, 50, 100<br>é»æ“ŠæŒ‰éˆ•åˆ‡æ›æ’­æ”¾é€Ÿåº¦
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // --- 1. å®šç¾©æ™‚ä»£åœ–æ¨™æ˜ å°„è¡¨ ---
    // ä½ å¯ä»¥åœ¨é€™è£¡æ›´æ›ä½ çš„æœ¬åœ°åœ–ç‰‡è·¯å¾‘
    const iconConfig = {
        "èˆŠçŸ³å™¨æ™‚ä»£": "paleolithic.png",
        "ç¹©ç´‹æ™‚ä»£": "jomon.png",
        "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)": "yayoi.jp.png",
        "kofun": "kofun_icon.png",
        "é è¨­åœ–ç‰‡": "Gemini_Generated_Image_jzkiiqjzkiiqjzki.png"
    };

    // --- 2. éºè·¡è³‡æ–™ (æ–°å¢ iconType å±¬æ€§) ---
    const locations = [
        {
            iconType: "ç¹©ç´‹æ™‚ä»£",
            name: "å…¥æ±Ÿãƒ»é«˜ç ‚è²å¡šéºå€",
            period: "ç¹©ç´‹æ™‚ä»£ (ä¸­/æ™šæœŸ)",
            latlng: [42.5512, 140.7675],
            startYear: -3500,
            endYear: -800,
            description: "ä½æ–¼åŒ—æµ·é“æ´çˆºæ¹–ç•”ã€‚é€™æ˜¯ä¸€è™•åŒ…å«å±…ä½å€èˆ‡å¢“åœ°çš„è²å¡šï¼Œå‡ºåœŸäº†åæ˜ ç•¶æ™‚äººèˆ‡æµ·æ´‹è³‡æºç·Šå¯†é—œä¿‚çš„éºç‰©ã€‚",
            sources: [
                { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤(å…¥æ±Ÿè²å¡š)", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/irie" },
                { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤(é«˜ç ‚è²å¡š)", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/takasago" }
            ]
        },
        {
            iconType: "ç¹©ç´‹æ™‚ä»£",
            name: "ä¸‰å…§ä¸¸å±±éºå€",
            period: "ç¹©ç´‹æ™‚ä»£ (æ—©/ä¸­æœŸ)",
            latlng: [40.8117, 140.6975],
            startYear: -3900,
            endYear: -2200,
            description: "æ—¥æœ¬æœ€å¤§è¦æ¨¡çš„å®šå±…æ‘è½éºè·¡ã€‚ç™¼ç¾äº†å·¨å¤§çš„ç«‹æŸ±å»ºç¯‰éºè·¡èˆ‡å¤§é‡çš„è²¿æ˜“ç‰©å“ï¼Œé¡¯ç¤ºç•¶æ™‚å·²æœ‰ç™¼é”çš„ç¤¾æœƒçµ„ç¹”ã€‚",
            sources: [
                { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/sannai-maruyama" },
                { label: "ğŸ”—ä¸‰å…§ä¸¸å±±ç‰¹åˆ¥å²è·¡å®˜ç¶²", url: "https://sannaimaruyama.pref.aomori.jp/chinese/" }
            ]
        },
        {
            iconType: "ç¹©ç´‹æ™‚ä»£",
            name: "å¤§æ¹¯ç’°ç‹€åˆ—çŸ³",
            period: "ç¹©ç´‹æ™‚ä»£ (å¾ŒæœŸ)",
            latlng: [40.2711, 140.8064],
            startYear: -2000,
            endYear: -1500,
            description: "ä½æ–¼ç§‹ç”°ç¸£ï¼Œç”±é‡ä¸­å ‚èˆ‡è¬åº§å…©å€‹åœ“ç’°çµ„æˆçš„å·¨å¤§çŸ³é™£ï¼Œè¢«èªç‚ºæ˜¯ç¥­ç¥€èˆ‡è§€æ¸¬å­£ç¯€è®Šæ›çš„è–åœ°ã€‚",
            sources: [
                { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/oyu" },
                { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/13837/" }
            ]
        },
        {
            iconType: "ç¹©ç´‹æ™‚ä»£",
            name: "å°–çŸ³çŸ³å™¨æ™‚ä»£éºè·¡",
            period: "ç¹©ç´‹æ™‚ä»£ (ä¸­æœŸ)",
            latlng: [36.0125, 138.2386],
            startYear: -3000,
            endYear: -2000,
            description: "ä½æ–¼é•·é‡ç¸£èŒ…é‡å¸‚ã€‚å‡ºåœŸäº†å…©å°Šæ—¥æœ¬åœ‹å¯¶é™¶å¶ï¼šã€ç¹©ç´‹å¥³ç¥ã€èˆ‡ã€å‡é¢å¥³ç¥ã€ï¼Œæ˜¯æ—¥æœ¬ç¹©ç´‹è—è¡“çš„å·”å³°ã€‚",
            sources: [
                { label: "ğŸ”—å°–çŸ³è€ƒå¤åšç‰©é¤¨", url: "https://www.city.chino.lg.jp/site/togariishi/" }
            ]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "å‰é‡é‡Œéºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (å…¨æœŸ)",
            latlng: [33.3267, 130.3842],
            startYear: -300,
            endYear: 300,
            description: "ä½æ–¼ä½è³€ç¸£ï¼Œæ˜¯æ—¥æœ¬è¦æ¨¡æœ€å¤§çš„ç’°å£•é›†è½éºå€ã€‚é€™è£¡é‡ç¾äº†å½Œç”Ÿæ™‚ä»£çš„é«˜åºŠå¼å€‰åº«ã€ç¥­å£‡èˆ‡ç‹å¢“ï¼Œæ˜¯ç ”ç©¶å½Œç”Ÿç¤¾æœƒçµæ§‹æœ€é‡è¦çš„åœ°é»ã€‚",
            sources: [
                { label: "ğŸ”—å‰é‡é‡Œæ­·å²å…¬åœ’å®˜ç¶²", url: "https://www.yoshinogari.jp/" },
                { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/11584/" },
                { label: "ğŸ”—å‰é‡é‡Œæ­·å²å…¬åœ’å®˜ç¶²å°çŸ¥è­˜", url: "https://www.yoshinogari.jp/ch_h/introduction/qa/" }
            ]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "ç™»å‘‚éºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (å¾ŒæœŸ)",
            latlng: [34.9564, 138.4081],
            startYear: 100,
            endYear: 300,
            description: "ä½æ–¼éœå²¡ç¸£ã€‚é€™è£¡æ˜¯é¦–æ¬¡ç™¼ç¾å½Œç”Ÿæ™‚ä»£å®Œæ•´æ°´ç”°çµæ§‹çš„éºå€ï¼Œè­‰æ˜äº†ç•¶æ™‚ç™¼é”çš„ç¨»ä½œæ–‡åŒ–èˆ‡çŒæº‰æŠ€è¡“ã€‚",
            sources: [
                { label: "ğŸ”—ç™»å‘‚åšç‰©é¤¨", url: "https://www.yoshinogari.jp/" },
                { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/18214/" }
            ]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "æ¿ä»˜éºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (æ—©æœŸ)",
            latlng: [33.5682, 130.4539],
            startYear: -400,
            endYear: 100,
            description: "ä½æ–¼ç¦å²¡ç¸£ã€‚æ—¥æœ¬æœ€å¤è€çš„æ°´ç”°ç¨»ä½œé›†è½ä¹‹ä¸€ï¼Œè­‰å¯¦äº†ç¹©ç´‹æœ«æœŸåˆ°å½Œç”ŸåˆæœŸå°±å·²é–‹å§‹ç©©å®šçš„ç¨»ç±³ç¨®æ¤ã€‚",
            sources: [
                { label: "ğŸ”—ç¦å²¡å¸‚ç¶“æ¿Ÿè§€å…‰æ–‡åŒ–å±€", url: "https://bunkazai.city.fukuoka.lg.jp/sp/cultural_properties/detail/430" },
                { label: "ğŸ”—Tripè¨‚æˆ¿ç¶²", url: "https://tw.trip.com/travel-guide/attraction/fukuoka/itazuke-iseki-38740036/" }
            ]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "å‰æ­¦é«˜æœ¨éºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (æ—©/ä¸­æœŸ)",
            latlng: [33.5379, 130.3185],
            startYear: -200,
            endYear: 100,
            description: "ä½æ–¼ç¦å²¡ç¸£ã€‚è¢«è­½ç‚ºã€åœ‹ç‹ä¹‹å¢“ã€ï¼Œå‡ºåœŸäº†æœ€æ—©çš„éŠ…åŠã€éŠ…é¡ã€å‹¾ç‰ï¼ˆä¸‰ç¥å™¨åŸå‹ï¼‰çµ„åˆã€‚",
            sources: [
                { label: "ğŸ”—ç¦å²¡å¸‚ç¶“æ¿Ÿè§€å…‰æ–‡åŒ–å±€", url: "https://bunkazai.city.fukuoka.lg.jp/yoshitaketakagi/" }
            ]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "åŸä¹‹è¾»éºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (æ—©/å¤å¢³æ™‚ä»£)",
            latlng: [33.7583, 129.7547],
            startYear: -200,
            endYear: 100,
            description: "é•·å´ç¸£å£¹å²å³¶ã€‚ä¸­åœ‹å²æ›¸è¨˜è¼‰çš„ã€ä¸€æ”¯åœ‹ã€éƒ½åŸï¼Œæ˜¯å½Œç”Ÿæ™‚ä»£é‡è¦çš„æµ·ä¸Šè²¿æ˜“è½‰é‹ç«™ã€‚",
            sources: [
                { label: "ğŸ”—ä¸€æ”¯åœ‹åšç‰©é¤¨", url: "http://www.iki-haku.jp/" }
            ]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "å”å¤ãƒ»éµéºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (å…¨æœŸ)",
            latlng: [34.5694, 135.7993],
            startYear: -200,
            endYear: 100,
            description: "ä½æ–¼å¥ˆè‰¯ç¸£ã€‚è¿‘ç•¿åœ°å€å…·ä»£è¡¨æ€§çš„ç’°å£•é›†è½ï¼Œå‡ºåœŸäº†å¤§é‡ç¹ªæœ‰å»ºç¯‰åœ–æ¡ˆçš„é™¶å™¨èˆ‡æœ¨è£½å“ã€‚",
            sources: [
                { label: "ğŸ”—å”å¤ãƒ»éµè€ƒå¤å­¸åšç‰©é¤¨", url: "https://www.town.tawaramoto.nara.jp/karakokagi/" }
            ]
        },
        {
            iconType: "èˆŠçŸ³å™¨æ™‚ä»£",
            name: "å²©å®¿éºå€",
            period: "èˆŠçŸ³å™¨æ™‚ä»£ (ä¸­/å¾ŒæœŸ)",
            latlng: [36.4001, 139.2875],
            startYear: -35000,
            endYear: -13000,
            description: "ä½æ–¼ç¾¤é¦¬ç¸£ã€‚1949å¹´ç”±ç›¸æ¾¤å¿ æ´‹ç™¼ç¾ï¼Œåœ¨é—œæ±å£¤åœŸå±¤ä¸­å‡ºåœŸäº†çŸ³å™¨ï¼Œè­‰æ˜äº†æ—¥æœ¬èˆŠçŸ³å™¨æ™‚ä»£çš„å­˜åœ¨ï¼Œå¾¹åº•æ”¹è®Šäº†æ—¥æœ¬å²å‰å²çš„ç ”ç©¶ã€‚",
            sources: [
                { label: "ğŸ”—å²©å®¿åšç‰©é¤¨", url: "https://www.city.midori.gunma.jp/iwajuku/" },
                { label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/spot/02301-12502001/" }
            ]
         },
         {
            iconType: "èˆŠçŸ³å™¨æ™‚ä»£",
            name: "ç ‚åŸéºå€",
            period: "èˆŠçŸ³å™¨æ™‚ä»£ (æ—©æœŸ) ç ”ç©¶ä¸­ï¼Œå¾…ç¢ºå®š",
            latlng: [35.4111, 132.6847], // å‡ºé›²åœ°å€
            startYear: -120000,
            endYear: -110000,
            description: "ä½æ–¼å³¶æ ¹ç¸£å‡ºé›²å¸‚ã€‚åœ¨æ­¤ç™¼ç¾äº†è¢«èªç‚ºæ˜¯æ—¥æœ¬æœ€å¤è€çš„çŸ³å™¨ï¼ˆç´„12è¬å¹´å‰ï¼‰ï¼Œé›–ç„¶å­¸ç•Œä»æœ‰çˆ­è«–ï¼Œä½†å®ƒæ˜¯æŒ‘æˆ°æ—¥æœ¬äººé¡å±…ä½å²æ¥µé™çš„é‡è¦éºå€ã€‚",
         },
         {
             iconType: "èˆŠçŸ³å™¨æ™‚ä»£",
             name: "çŸ¢å‡ºå·éºå€",
             period: "èˆŠçŸ³å™¨æ™‚ä»£ (æœ«æœŸ)",
             latlng: [35.9383, 138.4722], // é•·é‡ç¸£é‡é‚Šå±±é«˜åŸ
             startYear: -16000,
             endYear: -13000,
             description: "ä½æ–¼é•·é‡ç¸£ã€‚é€™æ˜¯æ—¥æœ¬æœ€æ—©ç™¼ç¾ã€ç´°çŸ³å™¨ã€ï¼ˆå¾®å°ç²¾ç´°çš„çŸ³åˆƒï¼‰çš„åœ°é»ï¼Œè±¡å¾µè‘—èˆŠçŸ³å™¨æ™‚ä»£å‘ç¹©ç´‹æ™‚ä»£éæ¸¡çš„æŠ€è¡“æ¼”é€²ã€‚",
             sources: [
                { label: "ğŸ”—æ–‡åŒ–åº", url: "https://bunka.nii.ac.jp/heritages/detail/216479" },
                { label: "ğŸ”—æ—¥æœ¬æ—§çŸ³å™¨å­¦ä¼š", url: "https://palaeolithic.jp/sites/yadegawa/index.htm" }
             ]
         }
    ];

    const map = L.map('map', { worldCopyJump: true, zoomControl: false }).setView([39.5, 138.5], 6); 
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // è¼”åŠ©å‡½å¼ï¼šå°‡å¹´ä»½æ•¸å­—è½‰ç‚ºä¸­æ–‡æ ¼å¼
    function formatYearText(year) {
        const y = Math.floor(year);
        if (y < 0) return `è¥¿å…ƒå‰ ${Math.abs(y).toLocaleString()}`;
        if (y === 0) return `è¥¿å…ƒ 1`;
        return `è¥¿å…ƒ ${y.toLocaleString()}`;
    }

    const aboutBtn = document.getElementById('aboutBtn');
    const aboutPanel = document.getElementById('aboutPanel');
    const closeAbout = document.getElementById('closeAbout');
    aboutBtn.onclick = () => { aboutPanel.classList.add('expanded'); aboutBtn.style.display = 'none'; };
    closeAbout.onclick = () => { aboutPanel.classList.remove('expanded'); setTimeout(() => aboutBtn.style.display = 'flex', 400); };



    // --- 3. åˆå§‹åŒ–æ¨™è¨˜ (ä¿®æ”¹æ­¤è™•ä»¥æ”¯æ´å¤šåœ–æ¨™) ---
    locations.forEach(loc => {
        // æ ¹æ“š iconType å¾æ˜ å°„è¡¨ä¸­é¸å–è·¯å¾‘ï¼Œè‹¥ç„¡å‰‡ç”¨é è¨­
        const iconPath = iconConfig[loc.iconType] || iconConfig["default"];

        const customIcon = L.icon({
            iconUrl: iconPath, 
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [0, -45]
        });

        const linksHTML = (loc.sources || []).map(s => 
            `<li class="source-item"><a href="${s.url}" target="_blank" class="source-link">${s.label}</a></li>`
        ).join('');

        const popupHTML = `
            <div style="width:250px;">
                <strong style="font-size:18px; color:#c0392b;">${loc.name}</strong><br>
                <div style="margin:5px 0; font-weight:bold; color:#d35400;">${loc.period}</div>
                <div style="font-size:13px; margin-bottom:5px;">
                    <b>æ´»èºæ™‚æœŸï¼š</b>${formatYearText(loc.startYear)} - ${formatYearText(loc.endYear)}
                </div>
                <p style="font-size:12px; color:#444; background:#f4f4f4; padding:8px; border-radius:4px;">${loc.description}</p>
                <ul class="source-list">${linksHTML}</ul>
            </div>`;
        
        loc.marker = L.marker(loc.latlng, {icon: customIcon}).bindPopup(popupHTML);
    });

    // --- æ ¸å¿ƒé‚è¼¯ ---
    const START = -120000, END = 2026;
    let currentYear = 2026;
    let isPlaying = false;
    let playTimer = null;
    const speeds = [1, 5, 10, 50, 100];
    let speedIndex = 2;

    function updateSpeedUI() {
        document.getElementById('speedDisplay').innerText = speeds[speedIndex] + " å¹´";
    }

    window.changeSpeed = function(delta) {
        speedIndex = Math.max(0, Math.min(speeds.length - 1, speedIndex + delta));
        updateSpeedUI();
    };

    function syncUI(y) {
        currentYear = Math.max(START, Math.min(END, y));
        document.getElementById('progressBar').style.width = ((currentYear - START) / (END - START)) * 100 + "%";
        document.getElementById('yearLabel').innerText = formatYearText(currentYear) + " å¹´";
        
        locations.forEach(loc => {
            if (currentYear >= loc.startYear && currentYear <= loc.endYear) {
                if (!map.hasLayer(loc.marker)) loc.marker.addTo(map);
            } else {
                if (map.hasLayer(loc.marker)) map.removeLayer(loc.marker);
            }
        });
    }

    document.getElementById('progressContainer').addEventListener('click', (e) => {
        const rect = e.currentTarget.getBoundingClientRect();
        const pct = (e.clientX - rect.left) / rect.width;
        syncUI(START + (END - START) * pct);
    });

    document.getElementById('jumpBtn').addEventListener('click', () => {
        const year = parseInt(document.getElementById('manualYearInput').value);
        if (!isNaN(year)) syncUI(year);
    });

    document.getElementById('playBtn').addEventListener('click', function() {
        if (isPlaying) {
            clearInterval(playTimer);
            this.innerText = "â–¶";
        } else {
            if (currentYear >= END) syncUI(START);
            playTimer = setInterval(() => {
                if (currentYear < END) {
                    syncUI(currentYear + speeds[speedIndex]);
                } else {
                    clearInterval(playTimer);
                    document.getElementById('playBtn').innerText = "â–¶";
                    isPlaying = false;
                }
            }, 50);
            this.innerText = "â…¡";
        }
        isPlaying = !isPlaying;
    });

    updateSpeedUI();
    syncUI(currentYear);
</script>
</body>
</html>