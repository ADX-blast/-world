<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸–ç•Œæ­·å²åœ°åœ– - ç¹©ç´‹æ™‚ä»£æ¢ç´¢</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; }

        .controls-overlay {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, rgba(255,255,255,0.95) 0%, transparent 100%);
            padding: 30px 40px 40px;
            z-index: 1000;
            pointer-events: none;
        }

        .controls-content {
            pointer-events: auto;
            max-width: 1000px;
            margin: 0 auto;
        }

        .progress-container {
            position: relative;
            height: 24px;
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .progress-bg {
            height: 8px; width: 100%;
            background: rgba(0,0,0,0.15);
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%; background: #e74c3c; width: 0%;
            border-radius: 10px; transition: width 0.1s linear;
        }

        .bottom-ui { display: flex; align-items: center; gap: 25px; }
        .play-btn {
            background: #2c3e50; border: none; color: #fff;
            width: 55px; height: 55px; border-radius: 50%; cursor: pointer;
            font-size: 22px; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease;
        }
        .play-btn:hover { background: #e74c3c; transform: scale(1.1); }
        
        .year-label { font-size: 28px; font-weight: 900; color: #2c3e50; min-width: 280px; }
        .precision-tag {
            font-size: 13px; padding: 5px 15px;
            background: #34495e; color: white; border-radius: 20px;
        }

        .source-list { margin: 8px 0 0 0; padding: 0; list-style: none; border-top: 1px dashed #ccc; padding-top: 8px; }
        .source-item { margin-bottom: 4px; }
        .source-link { color: #2ecc71; text-decoration: none; font-weight: bold; font-size: 13px; }
        .source-link:hover { color: #27ae60; text-decoration: underline; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="controls-overlay">
    <div class="controls-content">
        <div class="progress-container" id="progressContainer">
            <div class="progress-bg">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
        <div class="bottom-ui">
            <button class="play-btn" id="playBtn">â–¶</button>
            <div class="year-label" id="yearLabel">è¥¿å…ƒ 2026 å¹´</div>
            <div class="precision-tag" id="precisionTag">ç²¾åº¦: Â±10å¹´</div>
            <div style="font-size: 12px; color: #7f8c8d; margin-left: auto; text-align: right; line-height: 1.5;">
                <strong>é»æ“Šé€²åº¦æ¢è·³è½‰å¹´ä»½</strong><br>
                æ»¾è¼ªèª¿æ•´å¹´ä»½ / Ctrl+æ»¾è¼ªåˆ‡æ›ç²¾åº¦
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // --- 1. éºå€æ•¸æ“šé›† ---
    const locations = [
        {
            name: "å…¥æ±Ÿãƒ»é«˜ç ‚è²å¡šéºå€",
            period: "ç¹©ç´‹æ™‚ä»£ (ä¸­/æ™šæœŸ)",
            latlng: [42.5512, 140.7675],
            startYear: -3500,
            endYear: -800,
            description: "ä½æ–¼åŒ—æµ·é“æ´çˆºæ¹–ç•”ã€‚é€™æ˜¯ä¸€è™•åŒ…å«å±…ä½å€èˆ‡å¢“åœ°çš„è²å¡šï¼Œå‡ºåœŸäº†åæ˜ ç•¶æ™‚äººèˆ‡æµ·æ´‹è³‡æºç·Šå¯†é—œä¿‚çš„éºç‰©ã€‚",
            sources: [
                { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤(å…¥æ±Ÿè²å¡š)", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/irie" },
                { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤(é«˜ç ‚è²å¡š)", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/takasago" }
            ]
        },
        {
            name: "ä¸‰å…§ä¸¸å±±éºå€",
            period: "ç¹©ç´‹æ™‚ä»£ (æ—©/ä¸­æœŸ)",
            latlng: [40.8117, 140.6975],
            startYear: -3900,
            endYear: -2200,
            description: "æ—¥æœ¬æœ€å¤§è¦æ¨¡çš„å®šå±…æ‘è½éºè·¡ã€‚ç™¼ç¾äº†å·¨å¤§çš„ç«‹æŸ±å»ºç¯‰éºè·¡èˆ‡å¤§é‡çš„è²¿æ˜“ç‰©å“ï¼Œé¡¯ç¤ºç•¶æ™‚å·²æœ‰ç™¼é”çš„ç¤¾æœƒçµ„ç¹”ã€‚",
            sources: [
                { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/sannai-maruyama" },
                { label: "ğŸ”—ä¸‰å…§ä¸¸å±±ç‰¹åˆ¥å²è·¡å®˜ç¶²", url: "https://sannaimaruyama.pref.aomori.jp/chinese/" }
            ]
        },
        {
            name: "å¤§æ¹¯ç’°ç‹€åˆ—çŸ³",
            period: "ç¹©ç´‹æ™‚ä»£ (å¾ŒæœŸ)",
            latlng: [40.2711, 140.8064],
            startYear: -2000,
            endYear: -1500,
            description: "ä½æ–¼ç§‹ç”°ç¸£ï¼Œç”±é‡ä¸­å ‚èˆ‡è¬åº§å…©å€‹åœ“ç’°çµ„æˆçš„å·¨å¤§çŸ³é™£ï¼Œè¢«èªç‚ºæ˜¯ç¥­ç¥€èˆ‡è§€æ¸¬å­£ç¯€è®Šæ›çš„è–åœ°ã€‚",
            sources: [
                { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/oyu" },
                { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/13837/" }
            ]
        },
        {
            name: "å°–çŸ³çŸ³å™¨æ™‚ä»£éºè·¡",
            period: "ç¹©ç´‹æ™‚ä»£ (ä¸­æœŸ)",
            latlng: [36.0125, 138.2386],
            startYear: -3000,
            endYear: -2000,
            description: "ä½æ–¼é•·é‡ç¸£èŒ…é‡å¸‚ã€‚å‡ºåœŸäº†å…©å°Šæ—¥æœ¬åœ‹å¯¶é™¶å¶ï¼šã€ç¹©ç´‹å¥³ç¥ã€èˆ‡ã€å‡é¢å¥³ç¥ã€ï¼Œæ˜¯æ—¥æœ¬ç¹©ç´‹è—è¡“çš„å·”å³°ã€‚",
            sources: [
                { label: "ğŸ”—å°–çŸ³è€ƒå¤åšç‰©é¤¨", url: "https://www.city.chino.lg.jp/site/togariishi/" }
            ]
        }
    ];

    // --- 2. åœ°åœ–åŸºç¤è¨­å®š ---
    const map = L.map('map', { 
        worldCopyJump: true, 
        zoomControl: false 
    }).setView([39.5, 138.5], 6); 

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    const cavemanIcon = L.icon({
        iconUrl: 'Gemini_Generated_Image_jzkiiqjzkiiqjzki.png', 
        iconSize: [50, 50],
        iconAnchor: [25, 50],
        popupAnchor: [0, -45]
    });

    // è¼”åŠ©å‡½å¼ï¼šå°‡å¹´ä»½æ•¸å­—è½‰ç‚ºä¸­æ–‡æ ¼å¼
    function formatYearText(year) {
        const y = Math.floor(year);
        if (y < 0) return `è¥¿å…ƒå‰ ${Math.abs(y).toLocaleString()}`;
        if (y === 0) return `è¥¿å…ƒ 1`;
        return `è¥¿å…ƒ ${y.toLocaleString()}`;
    }

    // åˆå§‹åŒ–æ‰€æœ‰æ¨™è¨˜
    locations.forEach(loc => {
        const linksHTML = (loc.sources || []).map(s => 
            `<li class="source-item"><a href="${s.url}" target="_blank" class="source-link">${s.label}</a></li>`
        ).join('');

        const popupHTML = `
            <div style="width:250px;">
                <strong style="font-size:18px; color:#c0392b;">${loc.name}</strong><br>
                <div style="margin:5px 0; font-weight:bold; color:#d35400;">${loc.period}</div>
                <div style="font-size:13px; margin-bottom:5px;">
                    <b>æ´»èºæ™‚æœŸï¼š</b>${formatYearText(loc.startYear)} - ${formatYearText(loc.endYear)}
                </div>
                <p style="font-size:12px; color:#444; background:#f4f4f4; padding:8px; border-radius:4px;">${loc.description}</p>
                <ul class="source-list">${linksHTML}</ul>
            </div>`;
        
        loc.marker = L.marker(loc.latlng, {icon: cavemanIcon}).bindPopup(popupHTML);
    });

    // --- 3. æ™‚é–“è»¸æ ¸å¿ƒé‚è¼¯ ---
    const START = -16000;
    const END = 2026;
    let currentYear = 2026;
    let isPlaying = false;
    let playTimer = null;
    let zoomSteps = [1, 10, 50, 100, 500];
    let stepIndex = 1;

    const progressBar = document.getElementById('progressBar');
    const yearLabel = document.getElementById('yearLabel');
    const playBtn = document.getElementById('playBtn');

    function syncUI(y) {
        currentYear = Math.max(START, Math.min(END, y));
        
        const percent = ((currentYear - START) / (END - START)) * 100;
        progressBar.style.width = percent + "%";
        
        yearLabel.innerText = formatYearText(currentYear) + " å¹´";

        locations.forEach(loc => {
            if (currentYear >= loc.startYear && currentYear <= loc.endYear) {
                if (!map.hasLayer(loc.marker)) loc.marker.addTo(map);
            } else {
                if (map.hasLayer(loc.marker)) map.removeLayer(loc.marker);
            }
        });
    }

    // é»æ“Šé€²åº¦æ¢è·³è½‰
    document.getElementById('progressContainer').addEventListener('click', (e) => {
        const rect = e.currentTarget.getBoundingClientRect();
        const pct = (e.clientX - rect.left) / rect.width;
        syncUI(START + (END - START) * pct);
    });

    // æ’­æ”¾åŠŸèƒ½
    function startAutoPlay() {
        if (isPlaying) {
            clearInterval(playTimer);
            playBtn.innerText = "â–¶";
        } else {
            if (currentYear >= END) syncUI(START);
            playTimer = setInterval(() => {
                if (currentYear < END) {
                    syncUI(currentYear + zoomSteps[stepIndex]);
                } else {
                    clearInterval(playTimer);
                    playBtn.innerText = "â–¶";
                    isPlaying = false;
                }
            }, 60);
            playBtn.innerText = "â…¡";
        }
        isPlaying = !isPlaying;
    }

    playBtn.addEventListener('click', startAutoPlay);

    // æ»¾è¼ªæ§åˆ¶
    window.addEventListener('wheel', (e) => {
        if (e.ctrlKey) {
            e.preventDefault();
            stepIndex = (e.deltaY > 0) ? (stepIndex + 1) % zoomSteps.length : (stepIndex - 1 + zoomSteps.length) % zoomSteps.length;
            document.getElementById('precisionTag').innerText = `ç²¾åº¦: Â±${zoomSteps[stepIndex]}å¹´`;
        } else {
            syncUI(currentYear + (e.deltaY > 0 ? -zoomSteps[stepIndex] : zoomSteps[stepIndex]));
        }
    }, { passive: false });

    // åˆå§‹å•Ÿå‹•
    syncUI(currentYear);
</script>
</body>
</html>
