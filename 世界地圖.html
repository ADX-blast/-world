<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­·å²åœ°åœ–-æ—¥æœ¬ç¯‡</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
    .contact-link i:hover {
    color: #e74c3c !important; /* æ»‘é¼ ç§»ä¸Šå»æ™‚è®Šç‚ºç´…è‰² */
    transform: scale(1.1);
    }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; }

        .controls-overlay {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, rgba(255,255,255,0.95) 0%, transparent 100%);
            padding: 20px 40px 40px; z-index: 1000; pointer-events: none;
        }
        .controls-content { pointer-events: auto; max-width: 1200px; margin: 0 auto; }

        .progress-container {
            position: relative; height: 24px; display: flex;
            align-items: center; cursor: pointer; margin-bottom: 20px;
        }
        .progress-bg { height: 10px; width: 100%; background: rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background: #e74c3c; width: 0%; border-radius: 10px; transition: width 0.2s ease-out; }

        .bottom-ui { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        
        .play-btn {
            background: #2c3e50; border: none; color: #fff;
            width: 55px; height: 55px; border-radius: 50%; cursor: pointer;
            font-size: 22px; display: flex; align-items: center; justify-content: center;
            transition: background 0.2s;
        }
        .play-btn:hover { background: #e74c3c; }

        .about-widget {
    position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
    z-index: 1001; display: flex; flex-direction: column; align-items: flex-end;
}

.about-btn {
    width: 50px; height: 50px; background: #2c3e50; color: white;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 24px; font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.about-btn:hover { background: #e74c3c; transform: scale(1.1); }

.about-panel {
    width: 0; height: 0; opacity: 0; overflow: hidden;
    background: rgba(255, 255, 255, 0.95); border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    transition: all 0.4s ease; position: relative;
    backdrop-filter: blur(5px); border: 1px solid #ddd;
}

/* æ“´å±•å¾Œçš„ç‹€æ…‹ */
.about-panel.expanded {
    width: 300px; height: auto; min-height: 400px; opacity: 1; padding: 25px;
    margin-right: 10px;
}

.close-about { position: absolute; top: 15px; right: 15px; cursor: pointer; font-size: 20px; color: #95a5a6; }
.close-about:hover { color: #e74c3c; }

.about-content h2 { margin-top: 0; color: #2c3e50; border-bottom: 2px solid #e74c3c; padding-bottom: 10px; }
.era-badge { background: #e67e22; color: white; padding: 4px 12px; border-radius: 20px; font-weight: bold; display: inline-block; }


        .year-info { display: flex; flex-direction: column; min-width: 220px; }
        .year-label { font-size: 26px; font-weight: 900; color: #2c3e50; line-height: 1; }
        
        .control-group {
            display: flex; align-items: center; gap: 8px;
            background: rgba(255,255,255,0.9); padding: 8px 15px;
            border-radius: 8px; border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .year-input { width: 80px; padding: 6px; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
        
        .speed-ctrl { display: flex; align-items: center; gap: 5px; }
        .speed-display {
            background: #f8f9fa; border: 1px solid #ccc; color: #2c3e50; 
            padding: 6px 0; border-radius: 4px; font-weight: bold; font-size: 14px;
            width: 70px; text-align: center;
        }
        
        .ui-btn {
            background: #34495e; color: white; border: none; 
            padding: 6px 12px; border-radius: 4px; cursor: pointer; 
            font-size: 14px; font-weight: bold; transition: background 0.2s;
        }
        .ui-btn:hover { background: #e74c3c; }

        /* Popup æ¨£å¼å„ªåŒ– */
        .source-list { margin: 8px 0 0 0; padding-left: 18px; font-size: 13px; }
        .source-link { color: #2ecc71; text-decoration: none; font-weight: bold; }
        .source-link:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="about-widget" id="aboutWidget">
    <div class="about-panel" id="aboutPanel">
        <span class="close-about" id="closeAbout">Ã—</span>
        <div class="about-content">
            <h2>é—œæ–¼æœ¬åœ–</h2>
            <p>é€™æ˜¯ä¸€å€‹äº’å‹•å¼æ­·å²åœ°ç†ç³»çµ±ã€‚é€éæ™‚é–“è»¸çš„æ»‘å‹•ï¼Œæ‚¨å¯ä»¥è§€å¯Ÿå„å€‹åœ°å€æ–‡æ˜èˆ‡æ™‚ä»£çš„ç™¼å±•éç¨‹ã€‚ç›®å‰åªè£½ä½œæ—¥æœ¬åœ°å€</p>
            <p><b>æ“ä½œæŒ‡å—ï¼š</b></p>
            <ul style="font-size: 13px; color: #7f8c8d;">
                <li>æ‹–å‹•ä¸‹æ–¹é€²åº¦æ¢åˆ‡æ›å¹´ä»½</li>
                <li>ä½¿ç”¨æ’­æ”¾æŒ‰éˆ•ï¼ˆâ–¶ï¼‰è‡ªå‹•é‹è¡Œ</li>
                <li>èª¿æ•´é€Ÿåº¦ç´šåˆ¥ï¼ˆ1-100å¹´ï¼‰</li>
            </ul>
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
            <p><b>è‹¥æœ‰éŒ¯èª¤æˆ–å»ºè­°è«‹è¯çµ¡æˆ‘ï¼š</b></p>
            <div style="margin-top: 10px;">
            <a href="mailto:rty89209@gmail.com" class="contact-link" title="å‚³é€éƒµä»¶è¯çµ¡æˆ‘">
        <i class="fa-regular fa-envelope" style="font-size: 28px; color: #2c3e50; transition: color 0.2s;"></i>
    </a>
</div>
        </div>
    </div>
    <div class="about-btn" id="aboutBtn">i</div>
</div>

<div class="controls-overlay">
    <div class="controls-content">
        <div class="progress-container" id="progressContainer">
            <div class="progress-bg"><div class="progress-bar" id="progressBar"></div></div>
        </div>

        <div class="bottom-ui">
            <button class="play-btn" id="playBtn">â–¶</button>
            
            <div class="year-info">
                <div class="year-label" id="yearLabel">è¼‰å…¥ä¸­...</div>
                <div style="font-size: 11px; color: #7f8c8d; margin-top: 4px;">æ»¾è¼ªç¸®æ”¾åœ°åœ– / ä½¿ç”¨æŒ‰éˆ•æ§åˆ¶æ™‚é–“</div>
            </div>

            <div class="control-group">
                <span style="font-size: 13px; font-weight: bold; color: #34495e;">è·³è½‰:</span>
                <input type="number" id="manualYearInput" class="year-input" placeholder="å¹´ä»½">
                <button class="ui-btn" id="jumpBtn">åŸ·è¡Œ</button>
            </div>

            <div class="control-group">
                <span style="font-size: 13px; font-weight: bold; color: #34495e;">é‹è¡Œé€Ÿåº¦:</span>
                <div class="speed-ctrl">
                    <button class="ui-btn" onclick="changeSpeed(-1)">ï¼</button>
                    <div class="speed-display" id="speedDisplay">10 å¹´</div>
                    <button class="ui-btn" onclick="changeSpeed(1)">ï¼‹</button>
                </div>
            </div>

            <div style="font-size: 11px; color: #95a5a6; margin-left: auto; text-align: right;">
                é€Ÿåº¦ç´šåˆ¥ï¼š1, 5, 10, 50, 100<br>é»æ“ŠæŒ‰éˆ•åˆ‡æ›æ’­æ”¾é€Ÿåº¦
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // --- 1. å®šç¾©æ™‚ä»£åœ–æ¨™æ˜ å°„è¡¨ ---
    // ä½ å¯ä»¥åœ¨é€™è£¡æ›´æ›ä½ çš„æœ¬åœ°åœ–ç‰‡è·¯å¾‘
    const iconConfig = {
        "èˆŠçŸ³å™¨æ™‚ä»£": "paleolithic.png",
        "ç¹©ç´‹æ™‚ä»£": "jomon.png",
        "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)": "yayoi.jp.png",
        "å¤å¢³æ™‚ä»£": "kofun.jp.png",
        "é£›é³¥æ™‚ä»£": "Asuka Period.jp.png",
        "å¥ˆè‰¯æ™‚ä»£": "Nara Period.jp.png",
        "é è¨­åœ–ç‰‡": "Gemini_Generated_Image_jzkiiqjzkiiqjzki.png"
    };

    // --- 2. éºè·¡è³‡æ–™ (æ–°å¢ iconType å±¬æ€§) ---
     const locations = [
        {
            iconType: "ç¹©ç´‹æ™‚ä»£",
            name: "å…¥æ±Ÿãƒ»é«˜ç ‚è²å¡šéºå€",
            period: "ç¹©ç´‹æ™‚ä»£ (ä¸­/æ™šæœŸ)",
            latlng: [42.5512, 140.7675],
            startYear: -3500,
            endYear: -800,
            description: "ä½æ–¼åŒ—æµ·é“æ´çˆºæ¹–ç•”ã€‚é€™æ˜¯ä¸€è™•åŒ…å«å±…ä½å€èˆ‡å¢“åœ°çš„è²å¡šï¼Œå‡ºåœŸäº†åæ˜ ç•¶æ™‚äººèˆ‡æµ·æ´‹è³‡æºç·Šå¯†é—œä¿‚çš„éºç‰©ã€‚",
            sources: [{ label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤(å…¥æ±Ÿè²å¡š)", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/irie" },
                      { label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤(é«˜ç ‚è²å¡š)", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/takasago" }]
        },
        {
            iconType: "ç¹©ç´‹æ™‚ä»£",
            name: "ä¸‰å…§ä¸¸å±±éºå€",
            period: "ç¹©ç´‹æ™‚ä»£ (æ—©/ä¸­æœŸ)",
            latlng: [40.8117, 140.6975],
            startYear: -3900,
            endYear: -2200,
            description: "æ—¥æœ¬æœ€å¤§è¦æ¨¡çš„å®šå±…æ‘è½éºè·¡ã€‚ç™¼ç¾äº†å·¨å¤§çš„ç«‹æŸ±å»ºç¯‰éºè·¡èˆ‡å¤§é‡çš„è²¿æ˜“ç‰©å“ï¼Œé¡¯ç¤ºç•¶æ™‚å·²æœ‰ç™¼é”çš„ç¤¾æœƒçµ„ç¹”ã€‚",
            sources: [{ label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/sannai-maruyama" },
                      { label: "ğŸ”—ä¸‰å…§ä¸¸å±±ç‰¹åˆ¥å²è·¡å®˜ç¶²", url: "https://sannaimaruyama.pref.aomori.jp/chinese/" }]
        },
        {
            iconType: "ç¹©ç´‹æ™‚ä»£",
            name: "å¤§æ¹¯ç’°ç‹€åˆ—çŸ³",
            period: "ç¹©ç´‹æ™‚ä»£ (å¾ŒæœŸ)",
            latlng: [40.2711, 140.8064],
            startYear: -2000,
            endYear: -1500,
            description: "ä½æ–¼ç§‹ç”°ç¸£ï¼Œç”±é‡ä¸­å ‚èˆ‡è¬åº§å…©å€‹åœ“ç’°çµ„æˆçš„å·¨å¤§çŸ³é™£ï¼Œè¢«èªç‚ºæ˜¯ç¥­ç¥€èˆ‡è§€æ¸¬å­£ç¯€è®Šæ›çš„è–åœ°ã€‚",
            sources: [{ label: "ğŸ”—æ—¥æœ¬åŒ—éƒ¨çš„ç¹©æ–‡éºè·¡ç¾¤", url: "https://jomon-japan.jp/zh-tw/learn/jomon-sites/oyu" },
                      { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/13837/" }]
        },
        {
            iconType: "ç¹©ç´‹æ™‚ä»£",
            name: "å°–çŸ³çŸ³å™¨æ™‚ä»£éºè·¡",
            period: "ç¹©ç´‹æ™‚ä»£ (ä¸­æœŸ)",
            latlng: [36.0125, 138.2386],
            startYear: -3000,
            endYear: -2000,
            description: "ä½æ–¼é•·é‡ç¸£èŒ…é‡å¸‚ã€‚å‡ºåœŸäº†å…©å°Šæ—¥æœ¬åœ‹å¯¶é™¶å¶ï¼šã€ç¹©ç´‹å¥³ç¥ã€èˆ‡ã€å‡é¢å¥³ç¥ã€ï¼Œæ˜¯æ—¥æœ¬ç¹©ç´‹è—è¡“çš„å·”å³°ã€‚",
            sources: [{ label: "ğŸ”—å°–çŸ³è€ƒå¤åšç‰©é¤¨", url: "https://www.city.chino.lg.jp/site/togariishi/" }]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "å‰é‡é‡Œéºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (å…¨æœŸ)",
            latlng: [33.3267, 130.3842],
            startYear: -300,
            endYear: 300,
            description: "ä½æ–¼ä½è³€ç¸£ï¼Œæ˜¯æ—¥æœ¬è¦æ¨¡æœ€å¤§çš„ç’°å£•é›†è½éºå€ã€‚é€™è£¡é‡ç¾äº†å½Œç”Ÿæ™‚ä»£çš„é«˜åºŠå¼å€‰åº«ã€ç¥­å£‡èˆ‡ç‹å¢“ï¼Œæ˜¯ç ”ç©¶å½Œç”Ÿç¤¾æœƒçµæ§‹æœ€é‡è¦çš„åœ°é»ã€‚",
            sources: [{ label: "ğŸ”—å‰é‡é‡Œæ­·å²å…¬åœ’å®˜ç¶²", url: "https://www.yoshinogari.jp/" },
                      { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/11584/" },
                      { label: "ğŸ”—å‰é‡é‡Œæ­·å²å…¬åœ’å®˜ç¶²å°çŸ¥è­˜", url: "https://www.yoshinogari.jp/ch_h/introduction/qa/" }]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "ç™»å‘‚éºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (å¾ŒæœŸ)",
            latlng: [34.9564, 138.4081],
            startYear: 100,
            endYear: 300,
            description: "ä½æ–¼éœå²¡ç¸£ã€‚é€™è£¡æ˜¯é¦–æ¬¡ç™¼ç¾å½Œç”Ÿæ™‚ä»£å®Œæ•´æ°´ç”°çµæ§‹çš„éºå€ï¼Œè­‰æ˜äº†ç•¶æ™‚ç™¼é”çš„ç¨»ä½œæ–‡åŒ–èˆ‡çŒæº‰æŠ€è¡“ã€‚",
            sources: [{ label: "ğŸ”—ç™»å‘‚åšç‰©é¤¨", url: "https://www.yoshinogari.jp/" },
                      { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/18214/" }]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "æ¿ä»˜éºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (æ—©æœŸ)",
            latlng: [33.5682, 130.4539],
            startYear: -400,
            endYear: 100,
            description: "ä½æ–¼ç¦å²¡ç¸£ã€‚æ—¥æœ¬æœ€å¤è€çš„æ°´ç”°ç¨»ä½œé›†è½ä¹‹ä¸€ï¼Œè­‰å¯¦äº†ç¹©ç´‹æœ«æœŸåˆ°å½Œç”ŸåˆæœŸå°±å·²é–‹å§‹ç©©å®šçš„ç¨»ç±³ç¨®æ¤ã€‚",
            sources: [{ label: "ğŸ”—ç¦å²¡å¸‚ç¶“æ¿Ÿè§€å…‰æ–‡åŒ–å±€", url: "https://bunkazai.city.fukuoka.lg.jp/sp/cultural_properties/detail/430" },
                      { label: "ğŸ”—Tripè¨‚æˆ¿ç¶²", url: "https://tw.trip.com/travel-guide/attraction/fukuoka/itazuke-iseki-38740036/" }]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "å‰æ­¦é«˜æœ¨éºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (æ—©/ä¸­æœŸ)",
            latlng: [33.5379, 130.3185],
            startYear: -200,
            endYear: 100,
            description: "ä½æ–¼ç¦å²¡ç¸£ã€‚è¢«è­½ç‚ºã€åœ‹ç‹ä¹‹å¢“ã€ï¼Œå‡ºåœŸäº†æœ€æ—©çš„éŠ…åŠã€éŠ…é¡ã€å‹¾ç‰ï¼ˆä¸‰ç¥å™¨åŸå‹ï¼‰çµ„åˆã€‚",
            sources: [{ label: "ğŸ”—ç¦å²¡å¸‚ç¶“æ¿Ÿè§€å…‰æ–‡åŒ–å±€", url: "https://bunkazai.city.fukuoka.lg.jp/yoshitaketakagi/" }]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "åŸä¹‹è¾»éºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (æ—©/å¤å¢³æ™‚ä»£)",
            latlng: [33.7583, 129.7547],
            startYear: -200,
            endYear: 100,
            description: "é•·å´ç¸£å£¹å²å³¶ã€‚ä¸­åœ‹å²æ›¸è¨˜è¼‰çš„ã€ä¸€æ”¯åœ‹ã€éƒ½åŸï¼Œæ˜¯å½Œç”Ÿæ™‚ä»£é‡è¦çš„æµ·ä¸Šè²¿æ˜“è½‰é‹ç«™ã€‚",
            sources: [{ label: "ğŸ”—ä¸€æ”¯åœ‹åšç‰©é¤¨", url: "http://www.iki-haku.jp/" }]
        },
        {
            iconType: "å½Œç”Ÿæ™‚ä»£(æ—¥æœ¬)",
            name: "å”å¤ãƒ»éµéºå€",
            period: "å½Œç”Ÿæ™‚ä»£ (å…¨æœŸ)",
            latlng: [34.5694, 135.7993],
            startYear: -200,
            endYear: 100,
            description: "ä½æ–¼å¥ˆè‰¯ç¸£ã€‚è¿‘ç•¿åœ°å€å…·ä»£è¡¨æ€§çš„ç’°å£•é›†è½ï¼Œå‡ºåœŸäº†å¤§é‡ç¹ªæœ‰å»ºç¯‰åœ–æ¡ˆçš„é™¶å™¨èˆ‡æœ¨è£½å“ã€‚",
            sources: [{ label: "ğŸ”—å”å¤ãƒ»éµè€ƒå¤å­¸åšç‰©é¤¨", url: "https://www.town.tawaramoto.nara.jp/karakokagi/" }]
        },
        {
            iconType: "èˆŠçŸ³å™¨æ™‚ä»£",
            name: "å²©å®¿éºå€",
            period: "èˆŠçŸ³å™¨æ™‚ä»£ (ä¸­/å¾ŒæœŸ)",
            latlng: [36.4001, 139.2875],
            startYear: -35000,
            endYear: -13000,
            description: "ä½æ–¼ç¾¤é¦¬ç¸£ã€‚1949å¹´ç”±ç›¸æ¾¤å¿ æ´‹ç™¼ç¾ï¼Œåœ¨é—œæ±å£¤åœŸå±¤ä¸­å‡ºåœŸäº†çŸ³å™¨ï¼Œè­‰æ˜äº†æ—¥æœ¬èˆŠçŸ³å™¨æ™‚ä»£çš„å­˜åœ¨ï¼Œå¾¹åº•æ”¹è®Šäº†æ—¥æœ¬å²å‰å²çš„ç ”ç©¶ã€‚",
            sources: [{ label: "ğŸ”—å²©å®¿åšç‰©é¤¨", url: "https://www.city.midori.gunma.jp/iwajuku/" },
                      { label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/spot/02301-12502001/" }]
         },
         {
            iconType: "èˆŠçŸ³å™¨æ™‚ä»£",
            name: "ç ‚åŸéºå€",
            period: "èˆŠçŸ³å™¨æ™‚ä»£ (æ—©æœŸ) ç ”ç©¶ä¸­ï¼Œå¾…ç¢ºå®š",
            latlng: [35.4111, 132.6847], // å‡ºé›²åœ°å€
            startYear: -120000,
            endYear: -110000,
            description: "ä½æ–¼å³¶æ ¹ç¸£å‡ºé›²å¸‚ã€‚åœ¨æ­¤ç™¼ç¾äº†è¢«èªç‚ºæ˜¯æ—¥æœ¬æœ€å¤è€çš„çŸ³å™¨ï¼ˆç´„12è¬å¹´å‰ï¼‰ï¼Œé›–ç„¶å­¸ç•Œä»æœ‰çˆ­è«–ï¼Œä½†å®ƒæ˜¯æŒ‘æˆ°æ—¥æœ¬äººé¡å±…ä½å²æ¥µé™çš„é‡è¦éºå€ã€‚",
         },
         {
             iconType: "èˆŠçŸ³å™¨æ™‚ä»£",
             name: "çŸ¢å‡ºå·éºå€",
             period: "èˆŠçŸ³å™¨æ™‚ä»£ (å¾ŒæœŸ)",
             latlng: [35.9383, 138.4722], // é•·é‡ç¸£é‡é‚Šå±±é«˜åŸ
             startYear: -16000,
             endYear: -13000,
             description: "ä½æ–¼é•·é‡ç¸£ã€‚é€™æ˜¯æ—¥æœ¬æœ€æ—©ç™¼ç¾ã€ç´°çŸ³å™¨ã€ï¼ˆå¾®å°ç²¾ç´°çš„çŸ³åˆƒï¼‰çš„åœ°é»ï¼Œè±¡å¾µè‘—èˆŠçŸ³å™¨æ™‚ä»£å‘ç¹©ç´‹æ™‚ä»£éæ¸¡çš„æŠ€è¡“æ¼”é€²ã€‚",
             sources: [{ label: "ğŸ”—æ–‡åŒ–åº", url: "https://bunka.nii.ac.jp/heritages/detail/216479" },
                       { label: "ğŸ”—æ—¥æœ¬æ—§çŸ³å™¨å­¦ä¼š", url: "https://palaeolithic.jp/sites/yadegawa/index.htm" }]
         },
         {
             iconType: "å¤å¢³æ™‚ä»£",
             name: "ä»å¾·å¤©çš‡é™µ (å¤§ä»™é™µå¤å¢³)",
             period: "å¤å¢³æ™‚ä»£ (ä¸­æœŸ)",
             latlng: [34.5644, 135.4839],
             startYear: 400,
             endYear: 500,
             description: "ä½æ–¼å¤§é˜ªåºœå ºå¸‚ã€‚æ—¥æœ¬æœ€å¤§çš„å‰æ–¹å¾Œåœ“å¢³ï¼Œèˆ‡åŸƒåŠèƒ¡å¤«é‡‘å­—å¡”ã€ä¸­åœ‹ç§¦å§‹çš‡é™µä¸¦ç¨±ç‚ºä¸–ç•Œä¸‰å¤§å¢³å¢“ã€‚",
             sources: [{ label: "ğŸ”—å ºå¸‚åšç‰©é¤¨", url: "https://www.city.sakai.lg.jp/kanko/hakubutsukan/" },
                       { label: "ğŸ”—å ºè§€å…‰æœƒå±•å”æœƒ", url: "https://www.sakai-tcb.or.jp/zh-tw/spot/detail/126" },
                       { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/12281/" },
                       { label: "ğŸ”—å®Œç¾è¡Œ", url: "https://tw.wamazing.com/media/article/a-3187/" }]

         },
         {
             iconType: "å¤å¢³æ™‚ä»£",
             name: "ç®¸å¢“å¤å¢³",
             period: "å¤å¢³æ™‚ä»£ (æ—©æœŸ)",
             latlng: [34.5395, 135.8411],
             startYear: 250,
             endYear: 350,
             description: "ä½æ–¼å¥ˆè‰¯ç¸£æ«»äº•å¸‚ã€‚è¢«èªç‚ºæ˜¯æœ€æ—©çš„å¤§å‹å‰æ–¹å¾Œåœ“å¢³ï¼Œå‚³èªªèˆ‡å‘å½Œå‘¼å¥³ç‹æœ‰é—œï¼Œè±¡å¾µè‘—å¤å¢³æ™‚ä»£çš„é–‹ç«¯ã€‚",
             sources: [{ label: "ğŸ”—JAPAN VIDEOS", url: "https://cooljapan-videos.com/tw/articles/wtrk0oxv" },
                       { label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/spot/02301-2400380/" }]
         },
         {
             iconType: "å¤å¢³æ™‚ä»£",
             name: "è—¤ä¹‹æœ¨å¤å¢³",
             period: "å¤å¢³æ™‚ä»£ (å¾ŒæœŸ)",
             latlng: [34.6111, 135.7289],
             startYear: 550,
             endYear: 600,
             description: "ä½æ–¼å¥ˆè‰¯ç¸£æ–‘é³©ç”ºã€‚é›–ç„¶è¦æ¨¡è¼ƒå°ï¼Œä½†å‡ºåœŸäº†æ¥µå…¶å¥¢è¯çš„é¦¬å…·èˆ‡é‡‘éŠ…é£¾å“ï¼Œä¸”æœªè¢«ç›œæ˜ï¼Œæ˜¯ç ”ç©¶å¤å¢³å·¥è—çš„å¯¶åº«ã€‚",
             sources: [{ label: "ğŸ”—ç¶­åŸºç™¾ç§‘", url: "https://zh.wikipedia.org/zh-tw/%E8%97%A4%E4%B9%8B%E6%9C%A8%E5%8F%A4%E5%A2%B3" },
                       { label: "ğŸ”—iwafu", url: "https://www.iwafu.com/tw/events/1035399" },
                       { label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/spot/02301-1301162/" }]

         },
         {
             iconType: "å¤å¢³æ™‚ä»£",
             name: "é«˜æ¾å¡šå¤å¢³",
             period: "å¤å¢³æ™‚ä»£ (å¾ŒæœŸ)",
             latlng: [34.4603, 135.8058],
             startYear: 650,
             endYear: 750,
             description: "ä½æ–¼å¥ˆè‰¯ç¸£æ˜æ—¥é¦™æ‘ã€‚ä»¥ç²¾ç¾çš„ã€é£›é³¥ç¾äººã€å£ç•«èåï¼Œèåˆäº†ä¸­åœ‹èˆ‡æœé®®åŠå³¶çš„æ–‡åŒ–é¢¨æ ¼ï¼Œæ˜¯æ—¥æœ¬ç¹ªç•«å²çš„å·”å³°ã€‚",
             sources: [{ label: "ğŸ”—åœ‹ç‡Ÿé£›é³¥æ­·å²å…¬åœ’", url: "https://www.asuka-park.jp/tw/area/takamatsuzuka/" },
                       { label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/spot/02301-1301163/" }]
         },
         {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "é£›é³¥æ¿è“‹å®®è·¡",
            period: "é£›é³¥æ™‚ä»£",
            latlng: [34.4735, 135.8214],
            startYear: 642,
            endYear: 655,
            description: "çš‡æ¥µå¤©çš‡çš„å®®æ®¿ã€‚é€™è£¡æ˜¯ã€Œä¹™å·³ä¹‹è®Šã€çš„ç™¼ç”Ÿåœ°ï¼Œè˜‡æˆ‘å…¥é¹¿åœ¨æ­¤è¢«æš—æ®ºï¼Œéš¨å¾Œé–‹å•Ÿäº†æ—¥æœ¬å²ä¸Šè‘—åçš„ã€Œå¤§åŒ–é©æ–°ã€ã€‚",
            sources: [{ label: "ğŸ”—æ˜æ—¥é¦™æ‘è§€å…‰å°è¦½", url: "https://asukamura.com/" },
                      { label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/spot/02301-2400043/" },
                      { label: "ğŸ”—æ˜“éŠç¶²", url: "https://vacation.eztravel.com.tw/sight/plc0000056665/%E9%A3%9B%E9%B3%A5%E6%9D%BF%E8%93%8B%E5%AE%AE%E8%B7%A1" }]
        },
        {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "é£›é³¥å¯º (æ³•èˆˆå¯º)",
            period: "é£›é³¥æ™‚ä»£",
            latlng: [34.4789, 135.8203],
            startYear: 596,
            endYear: 710,
            description: "æ—¥æœ¬æœ€å¤è€çš„æ­£å¼å¯ºé™¢ã€‚ç”±è˜‡æˆ‘æ°èˆˆå»ºï¼Œä¾›å¥‰è‘—è‘—åçš„ã€Œé£›é³¥å¤§ä½›ã€ï¼Œå±•ç¾äº†ç•¶æ™‚å—åˆ°åŒ—é­é¢¨æ ¼å½±éŸ¿çš„é€ åƒè—è¡“ã€‚",
            sources: [{ label: "ğŸ”—æ˜“éŠç¶²", url: "https://vacation.eztravel.com.tw/sight/plc0000056660/asuka-ji-%E9%A3%9B%E9%B3%A5%E5%AF%BA" },
                      { label: "ğŸ”—é‡‘åŸäº‹å‹™æ‰€", url: "https://voniblog.com/%E9%A3%9B%E9%B3%A5%E5%AF%BA/" }]
        },
        {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "çŸ³èˆå°å¤å¢³",
            period: "é£›é³¥æ™‚ä»£",
            latlng: [34.4667, 135.8267],
            startYear: 600,
            endYear: 700,
            description: "å·¨å¤§çš„æ–¹å¢³çŸ³å®¤ï¼Œé‡é”2300å™¸çš„å·¨çŸ³å¤–éœ²ã€‚ç›¸å‚³æ˜¯é£›é³¥æ™‚ä»£æ¬Šè‡£è˜‡æˆ‘é¦¬å­çš„å¢“ï¼Œæ˜¯é£›é³¥åœ°å€æœ€å£¯è§€çš„å·¨çŸ³å»ºç¯‰ã€‚",
            sources: [{ label: "ğŸ”—åœ‹ç‡Ÿé£›é³¥æ­·å²å…¬åœ’", url: "https://www.asuka-park.jp/tw/area/ishibutai/" },
                      { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "https://www.gltjp.com/zh-hant/directory/item/11635/" },
                      { label: "ğŸ”—JNTO", url: "https://www.japan.travel/tw/spot/1021/" }]
        },
        {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "é¾œå½¢çŸ³é€ ç‰©",
            period: "é£›é³¥æ™‚ä»£",
            latlng: [34.4752, 135.8228],
            startYear: 650,
            endYear: 710,
            description: "ç¥ç§˜çš„åœ“å½¢æ± èˆ‡æ°´æ¸ çµ„åˆï¼Œå…¶çŸ³æé›•åˆ»æˆçƒé¾œå½¢ç‹€ã€‚æ¨æ¸¬èˆ‡é½Šæ˜å¤©çš‡æ™‚æœŸçš„ç¥­ç¥€å„€å¼æˆ–å®®å»·ä¾›æ°´ç³»çµ±æœ‰é—œã€‚",
            sources: [{ label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/guide/NTJtrv0158-zh-tw/" }]
        },
        {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "æ³•éš†å¯º",
            period: "é£›é³¥æ™‚ä»£",
            latlng: [34.6141, 135.7356],
            startYear: 607,
            endYear: 710,
            description: "ç”±è–å¾·å¤ªå­èˆˆå»ºï¼Œå…¶è¥¿é™¢ä¼½è—æ˜¯ä¸–ç•Œç¾å­˜æœ€å¤è€çš„æœ¨é€ å»ºç¯‰ç¾¤ï¼Œ1993å¹´æˆç‚ºæ—¥æœ¬é¦–å€‹ä¸–ç•Œæ–‡åŒ–éºç”¢ã€‚",
            sources: [{ label: "ğŸ”—æ³•éš†å¯ºå®˜ç¶²", url: "http://www.horyuji.or.jp/" },
                      { label: "ğŸ”—å¥½é‹æ—¥æœ¬è¡Œ", url: "http://www.horyuji.or.jp/" },
                      { label: "ğŸ”—æ³•éš†å¯ºãƒ»ä¸­å®®å¯ºå·¡ç¦®", url: "https://booking.letsgojp.com/plans/3284" }]
        },
        {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "ä¸­å®®å¯º",
            period: "é£›é³¥æ™‚ä»£",
            latlng: [34.6147, 135.7383],
            startYear: 620,
            endYear: 710,
            description: "ç·Šé„°æ³•éš†å¯ºï¼Œç”±è–å¾·å¤ªå­ç‚ºå…¶æ¯åå»ºç«‹çš„å°¼é™¢ã€‚å¯ºå…§ä¾›å¥‰çš„ã€Œè©è–©åŠè·åƒã€è¢«è­½ç‚ºä¸–ç•Œä¸‰å¤§å¾®ç¬‘åƒä¹‹ä¸€ã€‚",
            sources: [{ label: "ğŸ”—IKIDANE", url: "https://ikidane-nippon.com/zh-Hant-TW/spots/chugu-ji" },
                      { label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/spot/02301-14400827n/" },
                      { label: "ğŸ”—æ³•éš†å¯ºãƒ»ä¸­å®®å¯ºå·¡ç¦®", url: "https://booking.letsgojp.com/plans/3284" }]
        },
        {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "é›£æ³¢å®®è·¡",
            period: "é£›é³¥æ™‚ä»£ / å¥ˆè‰¯æ™‚ä»£",
            latlng: [34.6806, 135.5233],
            startYear: 645,
            endYear: 784,
            description: "å¤§åŒ–é©æ–°å¾Œé·éƒ½çš„åœ°é»ã€‚æ­¤è™•ç™¼ç¾äº†å…©æœŸå»ºç¯‰éºæ§‹ï¼šå‰æœŸé›£æ³¢å®®ï¼ˆé£›é³¥æ™‚æœŸï¼‰èˆ‡å¾ŒæœŸé›£æ³¢å®®ï¼ˆå¥ˆè‰¯æ™‚æœŸï¼‰ã€‚",
            sources: [{ label: "ğŸ”—Japan Travel", url: "https://japantravel.navitime.com/zh-tw/area/jp/spot/02301-1903192/" },
                      { label: "ğŸ”—å¤§é˜ªå¸‚å»ºè¨­å±€ä¼åŠƒéƒ¨", url: "https://takenouchikaidou.com/zh-TW/page/naniwa-no-miya-ato-park" }]
        },
        {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "è¿‘æ±Ÿå¤§æ´¥å®®è·¡",
            period: "é£›é³¥æ™‚ä»£",
            latlng: [35.0211, 135.8567],
            startYear: 667,
            endYear: 672,
            description: "å¤©æ™ºå¤©çš‡é·éƒ½è‡³æ»‹è³€å¤§æ´¥ã€‚é›–ç„¶é·éƒ½æ™‚é–“åƒ…äº”å¹´ï¼Œä½†åœ¨æ­¤é ’å¸ƒäº†ã€Šè¿‘æ±Ÿä»¤ã€‹ï¼Œæ˜¯æ—¥æœ¬å¾‹ä»¤åˆ¶æ³•å¾‹çš„é‡è¦åŸºçŸ³ã€‚",
            sources: [{ label: "ğŸ”—æ–‡åŒ–åº", url: "https://bunka.nii.ac.jp/heritages/detail/163041" },
                      { label: "ğŸ”—iwafu", url: "https://www.iwafu.com/tw/events/1017848" }]
        },
        {
            iconType: "å¥ˆè‰¯æ™‚ä»£",
            name: "å¹³åŸå®®è·¡ (å¹³åŸäº¬)",
            period: "å¥ˆè‰¯æ™‚ä»£",
            latlng: [34.6931, 135.7944],
            startYear: 710,
            endYear: 784,
            description: "æ—¥æœ¬é¦–å€‹æ¨¡ä»¿å”æœé•·å®‰åŸå»ºç«‹çš„å®å¤§é¦–éƒ½ã€‚æ­¤éºå€ä¿ç•™äº†æœ±é›€é–€èˆ‡ç¬¬ä¸€æ¬¡å¤§æ¥µæ®¿ï¼Œè±¡å¾µè‘—å¤©å¹³æ–‡åŒ–çš„ç¹æ¦®ã€‚",
            sources: [{ label: "ğŸ”—å¹³åŸå®®è·¡æ­·å²å…¬åœ’", url: "https://www.heijo-park.jp/" }]
        },
        {
            iconType: "å¥ˆè‰¯æ™‚ä»£",
            name: "æ±å¤§å¯º (å¤§å’Œåœ‹ç¸½åœ‹åˆ†å¯º)",
            period: "å¥ˆè‰¯æ™‚ä»£",
            latlng: [34.6889, 135.8398],
            startYear: 728,
            endYear: 2026,
            description: "è–æ­¦å¤©çš‡æ‰€å»ºï¼Œä¾›å¥‰è‘—è‘—åçš„ã€Œå¥ˆè‰¯å¤§ä½›ã€ã€‚èº«ç‚ºå…¨åœ‹åœ‹åˆ†å¯ºä¹‹é¦–ï¼Œå®ƒæ˜¯ä½›æ•™å®ˆè­·åœ‹å®¶çš„ä¸­å¿ƒé»ã€‚",
            sources: [{ label: "ğŸ”—æ±å¤§å¯ºå®˜ç¶²", url: "http://www.todaiji.or.jp/" },
                      { label: "ğŸ”—æ­£å€‰é™¢", url: "https://shosoin.kunaicho.go.jp/" }]
        },
        {
            iconType: "å¥ˆè‰¯æ™‚ä»£",
            name: "å”æ‹›æå¯º",
            period: "å¥ˆè‰¯æ™‚ä»£",
            latlng: [34.6751, 135.7849],
            startYear: 759,
            endYear: 2026,
            description: "ç”±å”æœé«˜åƒ§é‘’çœŸå’Œå°šè¦ªè‡ªä¸‹ä»¤å»ºé€ ï¼Œæ˜¯å¾‹å®—çš„ç¸½æœ¬å±±ã€‚å…¶é‡‘å ‚ä¿ç•™äº†å¤©å¹³æ™‚ä»£æœ€ç´”ç²¹çš„å»ºç¯‰é¢¨æ ¼ã€‚",
            sources: [{ label: "ğŸ”—å”æ‹›æå¯ºå®˜ç¶²", url: "https://toushoudaiji.jp/" }]
        },
        {
            iconType: "å¥ˆè‰¯æ™‚ä»£",
            name: "è—¥å¸«å¯º",
            period: "é£›é³¥ / å¥ˆè‰¯æ™‚ä»£",
            latlng: [34.6681, 135.7844],
            startYear: 680,
            endYear: 2026,
            description: "ç”±å¤©æ­¦å¤©çš‡ç™¼é¡˜èˆˆå»ºï¼Œé·éƒ½å¹³åŸäº¬å¾Œé‡ä¿®ã€‚å…¶æ±å¡”è¢«è­½ç‚ºã€Œå‡çµçš„éŸ³æ¨‚ã€ï¼Œæ˜¯æ¥µå°‘æ•¸å¾å¥ˆè‰¯æ™‚ä»£å­˜ç•™è‡³ä»Šçš„å¤å¡”ã€‚",
            sources: [{ label: "ğŸ”—è—¥å¸«å¯ºå®˜ç¶²", url: "https://yakushiji.or.jp/" }]
        },
        {
            iconType: "å¥ˆè‰¯æ™‚ä»£",
            name: "èˆˆç¦å¯º",
            period: "å¥ˆè‰¯æ™‚ä»£",
            latlng: [34.6830, 135.8306],
            startYear: 710,
            endYear: 2026,
            description: "è—¤åŸæ°çš„æ°å¯ºï¼Œæ˜¯æ³•ç›¸å®—çš„ä¸­å¿ƒã€‚å¯ºå…§çš„é˜¿ä¿®ç¾…åƒèˆ‡äº”é‡å¡”æ˜¯å¥ˆè‰¯æœ€å…·ä»£è¡¨æ€§çš„æ–‡åŒ–æ¨™èªŒã€‚",
            sources: [{ label: "ğŸ”—èˆˆç¦å¯ºå®˜ç¶²", url: "https://www.kohfukuji.com/" }]
        },
        {
            iconType: "å¥ˆè‰¯æ™‚ä»£",
            name: "æ­ä»äº¬è·¡ (å¤§æ¥µæ®¿éºå€)",
            period: "å¥ˆè‰¯æ™‚ä»£ (çŸ­æš«é·éƒ½)",
            latlng: [34.7645, 135.8617],
            startYear: 740,
            endYear: 744,
            description: "è–æ­¦å¤©çš‡ç‚ºäº†è„«é›¢ä½›æ•™å‹¢åŠ›å¹²é è€ŒçŸ­æš«é·éƒ½çš„åœ°é»ã€‚ç¾å­˜æœ‰å·¨å¤§çš„éºå€åŸºçŸ³ã€‚",
            sources: [{ label: "ğŸ”—æœ¨æ´¥å·å¸‚è§€å…‰å”æœƒ", url: "https://www.0774.or.jp/sightseeing/kunikyo/" }]
        },
        {
            iconType: "å¥ˆè‰¯æ™‚ä»£",
            name: "ç´«é¦™æ¨‚å®® (ç”²è³€å®®)",
            period: "å¥ˆè‰¯æ™‚ä»£ (çŸ­æš«é·éƒ½)",
            latlng: [34.9122, 136.0820],
            startYear: 742,
            endYear: 745,
            description: "è–æ­¦å¤©çš‡ä¸‹ä»¤é–‹å§‹é‘„é€ æ±å¤§å¯ºå¤§ä½›çš„æœ€åˆåœ°é»ï¼Œå¾Œå› ç«ç½èˆ‡åœ°éœ‡å›é·å¹³åŸäº¬ã€‚",
            sources: [{ label: "ğŸ”—æ»‹è³€ç¸£è§€å…‰å°è¦½", url: "https://www.biwako-visitors.jp/spot/detail/1446/" }]
        },
        {
            iconType: "é£›é³¥æ™‚ä»£",
            name: "å¾ŒæœŸé›£æ³¢å®®è·¡",
            period: "é£›é³¥ / å¥ˆè‰¯æ™‚ä»£",
            latlng: [34.6806, 135.5233],
            startYear: 744,
            endYear: 784,
            description: "å¥ˆè‰¯æ™‚ä»£çš„å‰¯éƒ½ï¼Œæ›¾ä½œç‚ºè–æ­¦å¤©çš‡çš„é™ªéƒ½ã€‚æ­¤è™•ç™¼æ˜å‡ºå¤§é‡çš„ç“¦ç‰‡èˆ‡å®˜åƒšè¾¦å…¬éºè·¡ã€‚",
            sources: [{ label: "ğŸ”—å¤§é˜ªæ­·å²åšç‰©é¤¨", url: "https://www.osakamushis.jp/" }]
        },
        {
            iconType: "å¥ˆè‰¯æ™‚ä»£",
            name: "å…ƒèˆˆå¯º",
            period: "å¥ˆè‰¯æ™‚ä»£",
            latlng: [34.6781, 135.8317],
            startYear: 710,
            endYear: 2026,
            description: "å¾é£›é³¥å¯ºé·è‡³å¹³åŸäº¬å¾Œçš„åç¨±ï¼Œæ˜¯æ—¥æœ¬æœ€å¤è€çš„ä½›å¯ºä¹‹ä¸€ã€‚å±‹é ‚ä¿ç•™äº†éƒ¨åˆ†é£›é³¥æ™‚ä»£çš„å¤è€ç“¦ç‰‡ã€‚",
            sources: [{ label: "ğŸ”—å…ƒèˆˆå¯ºå®˜ç¶²", url: "https://gangoji-tera.or.jp/" }]
        }







    ];

    const map = L.map('map', { worldCopyJump: true, zoomControl: false }).setView([39.5, 138.5], 6); 
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // è¼”åŠ©å‡½å¼ï¼šå°‡å¹´ä»½æ•¸å­—è½‰ç‚ºä¸­æ–‡æ ¼å¼
    function formatYearText(year) {
        const y = Math.floor(year);
        if (y < 0) return `è¥¿å…ƒå‰ ${Math.abs(y).toLocaleString()}`;
        if (y === 0) return `è¥¿å…ƒ 1`;
        return `è¥¿å…ƒ ${y.toLocaleString()}`;
    }

    const aboutBtn = document.getElementById('aboutBtn');
    const aboutPanel = document.getElementById('aboutPanel');
    const closeAbout = document.getElementById('closeAbout');
    aboutBtn.onclick = () => { aboutPanel.classList.add('expanded'); aboutBtn.style.display = 'none'; };
    closeAbout.onclick = () => { aboutPanel.classList.remove('expanded'); setTimeout(() => aboutBtn.style.display = 'flex', 400); };



    // --- 3. åˆå§‹åŒ–æ¨™è¨˜ (ä¿®æ”¹æ­¤è™•ä»¥æ”¯æ´å¤šåœ–æ¨™) ---
    locations.forEach(loc => {
        // æ ¹æ“š iconType å¾æ˜ å°„è¡¨ä¸­é¸å–è·¯å¾‘ï¼Œè‹¥ç„¡å‰‡ç”¨é è¨­
        const iconPath = iconConfig[loc.iconType] || iconConfig["default"];

        const customIcon = L.icon({
            iconUrl: iconPath, 
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [0, -45]
        });

        const linksHTML = (loc.sources || []).map(s => 
            `<li class="source-item"><a href="${s.url}" target="_blank" class="source-link">${s.label}</a></li>`
        ).join('');

        const popupHTML = `
            <div style="width:250px;">
                <strong style="font-size:18px; color:#c0392b;">${loc.name}</strong><br>
                <div style="margin:5px 0; font-weight:bold; color:#d35400;">${loc.period}</div>
                <div style="font-size:13px; margin-bottom:5px;">
                    <b>æ´»èºæ™‚æœŸï¼š</b>${formatYearText(loc.startYear)} - ${formatYearText(loc.endYear)}
                </div>
                <p style="font-size:12px; color:#444; background:#f4f4f4; padding:8px; border-radius:4px;">${loc.description}</p>
                <ul class="source-list">${linksHTML}</ul>
            </div>`;
        
        loc.marker = L.marker(loc.latlng, {icon: customIcon}).bindPopup(popupHTML);
    });

    // --- æ ¸å¿ƒé‚è¼¯ ---
    const START = -16000, END = 2026;
    let currentYear = 2026;
    let isPlaying = false;
    let playTimer = null;
    const speeds = [1, 5, 10, 50, 100];
    let speedIndex = 2;

    function updateSpeedUI() {
        document.getElementById('speedDisplay').innerText = speeds[speedIndex] + " å¹´";
    }

    window.changeSpeed = function(delta) {
        speedIndex = Math.max(0, Math.min(speeds.length - 1, speedIndex + delta));
        updateSpeedUI();
    };

    function syncUI(y) {
        currentYear = Math.max(START, Math.min(END, y));
        document.getElementById('progressBar').style.width = ((currentYear - START) / (END - START)) * 100 + "%";
        document.getElementById('yearLabel').innerText = formatYearText(currentYear) + " å¹´";
        
        locations.forEach(loc => {
            if (currentYear >= loc.startYear && currentYear <= loc.endYear) {
                if (!map.hasLayer(loc.marker)) loc.marker.addTo(map);
            } else {
                if (map.hasLayer(loc.marker)) map.removeLayer(loc.marker);
            }
        });
    }

    document.getElementById('progressContainer').addEventListener('click', (e) => {
        const rect = e.currentTarget.getBoundingClientRect();
        const pct = (e.clientX - rect.left) / rect.width;
        syncUI(START + (END - START) * pct);
    });

    document.getElementById('jumpBtn').addEventListener('click', () => {
        const year = parseInt(document.getElementById('manualYearInput').value);
        if (!isNaN(year)) syncUI(year);
    });

    document.getElementById('playBtn').addEventListener('click', function() {
        if (isPlaying) {
            clearInterval(playTimer);
            this.innerText = "â–¶";
        } else {
            if (currentYear >= END) syncUI(START);
            playTimer = setInterval(() => {
                if (currentYear < END) {
                    syncUI(currentYear + speeds[speedIndex]);
                } else {
                    clearInterval(playTimer);
                    document.getElementById('playBtn').innerText = "â–¶";
                    isPlaying = false;
                }
            }, 50);
            this.innerText = "â…¡";
        }
        isPlaying = !isPlaying;
    });

    updateSpeedUI();
    syncUI(currentYear);
</script>
</body>
</html>
